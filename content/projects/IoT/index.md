+++
date = '2025-08-22T16:52:51+09:00'
draft = false
title = '家庭用IoTサーバ'
slug = 'Home_IoT'
comments = true
+++

## 概要
部屋内の**家電**(PC,エアコン,etc)の操作や、部屋の状態(湿度,気温,ECo2,VoC値等々)の監視が出来るIoTサーバです。

## 製作理由
自宅ネットワークにVPNを入れた際に、外部ネットワークからPCの電源が付けられるサーバが欲しいと感じた。<br>
また、部屋にいる際、換気をするタイミングや部屋の温度が分からない事が多い。また、温度計などはPC等を見ているタイミングだと確認を怠ってしまう。そのためPC若しくはスマホなどのデバイスから見れる温度計が欲しくなった。<br>
更に、自分の部屋で開発することが多く、その際に熱中して周囲が見えなくなる事がある。その際に、換気をする事を忘れてしまう。そのため、「換気タイミングを通知するデバイスが有れば良いな」と考えた。<br>
更に、エアコンのリモコンが微妙に遠く、ベットに寝転んでいる時からエアコンを操作するには、ベットから出ないといけない。<br>
おまけに、部屋の向きが悪く、西日が強い、そのため部屋に帰るころには部屋がとても暑くなります。なので、「遠隔かつスマホでエアコンや赤外線リモコンを持つデバイスを操作出来ればQOLが上がるな。」と考えた。<br>
これらの悩み事や願望を叶えるためにこのシステムは制作された。

## 制作時期と遍歴
- 2023/10:製作開始
- 2023/12:大枠とPC起動機能、Discord通知機能の完成
- 2024/3 :IR機器の操作機能と温度計機能の追加
- 2025/4 :技育CAMPキャラバンに参加
- 2025/5 :内部構造の最適化
- 2025/5 :空気測定機能の追加
- 2025/5 :技育博に参加
- 2025/6 :Discord通知機能の故障により温度計及び空気測定機能の削除
- 2025/6 :Discord通知機能の修理と温度計、空気測定機能の分離
  
## 機能解説
- WakeOnLanを利用したPCの起動
- IR機器の操作
  - 冷房3段階、暖房3段階でのエアコンの操作を実現
- 一時間ごとの空気の測定と通知
  - 温度、湿度、不快指数の測定及び通知
  - ECo2値、TVOC値、AQI値の測定及び通知
  - 不快指数及びECo2値等から換気タイミングの測定及び通知
- Discord上に通知及びエラーメッセージ、サーバのステータス状態の送信
- Blynkを介した外部NWからの機能の実行
- VPNを介したSSHの実行
  - 個人で導入しているVPN網に導入しているため、
  
## Discordに送られる計測値の解説
- 温度(℃)
- 湿度(%)
- 不快指数
  - 夏の蒸し暑さを数量的に表した指数。温度湿度から計算可能。
- ECo2濃度(ppm)
  - 部屋の空気内の物質から推定されるCo2濃度のこと。大体の値が取れる。
- TVoC値(μg/m³)
  - 室内空気中に揮発している化学物質の総量を測定した値。
  - シックハウス症候群の人が気にする。
- AQI値
  - 空気質指数のこと。空気のキレイさが分かる。
## メッセージ例
### サーバの状態
```
Server_booted

Booting Desktop...
```

### 温度と湿度
```
temperature:38.69
humidity:42.63
unconfort index:87.87
```

### Eco2値など
```
eco2:502
aqi:2
tvoc:73
```

### エラーメッセージと警告
```
Too Unconfortable!!! Open rooms door!!
Too Much Co2!! Open room window!!
division by zero
```

## 使ったもの(ハードウェア)
- Raspberry pi 3b
  - メインサーバとして採用。
  - GPIOとLinuxが使える点が大きく、拡張性が高い。
- DHT11
  - 気温湿度センサとして採用した。
  - とても一般的かつ安価な温度センサであり、。情報がかなり多く、使いやすい。
- ADIR01P USB赤外線リモコンアドバンス
  - IR機器の制御用に採用した。
  - Linux対応しているのと、USB接続が可能な赤外線通信用のハードウェア。windowsにも対応しており、幅が広い。
- ENS160+AHT21
  - VoC及びECo2センサとして利用。
  - 安価にECo2を測定できるから採用した。
  - このセンサはI2C通信で通信できるため、かなり使い勝手が良い。
  - 
## 使ったもの(ソフトウェア)
- Blynk
  - 中間的なサーバ及びフロントエンドの開発環境、実行環境として採用。
- Python
  - メインの開発言語として利用。
- RaspberrypiOS
  - Raspberry piのOSとして採用。Debian系のOS。
- Discord
  - 通知を受け取るメッセンジャーアプリとして採用。

## スクリーンショット
### モバイル環境
![Mobile version](./Mobile.webp)
### PC(Web)
![Web Page version](./PC.webp)

## 制作して良かった点
- QOLが向上した
  - 換気若しくはエアコンをつけるタイミングを通知するのが大きい。
  - 更に、「帰る10分前にエアコン付けよ」とか「メインPC内のデータが必要だからメインPC起動してリモートデスクトップ繋ごう」や「実家帰ってもVPN介してPCVRやろう」が出来る。
  - 簡単に言うと超便利なリモコン(家の外でも利用可能)を手に入れたようなものである。
  - 事故でサーバが2週間程度止まった時は生活が大きく不便になった。
- Linuxの知識を深められた
  - 開発中は基本的にSSHを介してRaspberrypiを利用していたため、基本的なLinuxのファイル操作を覚えた。
  - 更に、Nanoなどコマンドラインエディタ、SSHにおけるユーザ、Systemdの操作を活用して動くものを作った。
- 日常の不満を解決する方法を考えられた
  - 「遠隔でPCを起動する。」という一つの命題から様々な機能が出来た。
- 自分のサーバを立てたという経験を得た
  - 個人でサーバを立てて、長期の運用をする経験をした。

## 苦労した点
- PythonのBlynkライブラリの導入
  - Blynkライブラリの情報が無く、頼りにしていた情報源でも導入が出来なかった。しかしながら、ライブラリのコードを読んだりしたことによって、最終的には導入することができた。
- Systemdの設定
  - 開発を始めたころは、Linuxのユーザ周りやデーモン辺りの知識が無かった。そのため、自分が作ったコードを継続して動かしたり、起動時の実行を行うためにSystemdを勉強する必要があった。初めての範囲で四苦八苦したものの、基本的な使い方が分かった。
- Co2センサの選定
  - Co2濃度を測定する際に、実際にCo2濃度を計るセンサを導入しようと考えた。がしかし、1週間のキャリブレーションが必要な物や一つ4000円を超える物しかなかった。そのため、最終的にはECo2という空気の奇麗さからCo2濃度を推定する値を計るセンサを導入した。

## 今後の展望
- サーバの安定化
- 赤外線機器の追加(シーリングライト及びサーキュレーター等)
- 公開と導入の解説を追加
- 部屋の照度を検知してライトが付いているかの検知
- Matter対応
